{"version":3,"sources":["assets\\Scripts\\Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import GameMgr from \"./GameMgr\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Player extends cc.Component \r\n{\r\n    @property()\r\n    playerSpeed: number = 300;\r\n\r\n    @property()\r\n    playerStandSpeed: number = 50;\r\n\r\n    @property({type:cc.AudioClip})\r\n    nailSound: cc.AudioClip = null;\r\n\r\n    @property({type:cc.AudioClip})\r\n    dieSound: cc.AudioClip = null;\r\n\r\n    @property(cc.Node)\r\n    gameMgr: cc.Node = null;\r\n    \r\n    private idleFrame: cc.SpriteFrame = null;\r\n\r\n    private anim: cc.Animation = null;\r\n\r\n    private moveDir = 0;\r\n\r\n    private ceilingPos: number = 155;\r\n\r\n    private fallDown: boolean = false;\r\n\r\n    private damageTime: number = 0;\r\n    onLoad()\r\n    {\r\n        cc.director.getPhysicsManager().enabled = true;            \r\n    }\r\n\r\n    start () {\r\n        this.idleFrame = this.getComponent(cc.Sprite).spriteFrame;\r\n        this.anim = this.getComponent(cc.Animation);\r\n    }\r\n\r\n    update(dt)\r\n    {\r\n        this.node.x += this.playerSpeed * this.moveDir * dt;\r\n        this.node.scaleX = (this.moveDir >= 0) ? 1 : -1;\r\n        this.node.y = (this.node.y >= this.ceilingPos) ? this.ceilingPos : this.node.y;\r\n        if(this.getComponent(cc.RigidBody).linearVelocity.y != this.playerStandSpeed)\r\n            this.fallDown = true;\r\n        else\r\n            this.fallDown = false;\r\n\r\n        if(this.damageTime > 0)\r\n            this.damageTime -= dt;\r\n        else\r\n            this.damageTime = 0;\r\n\r\n        this.playerAnimation();\r\n    }\r\n\r\n    reborn(rebornPos: cc.Vec2)\r\n    {\r\n        this.damageTime = 0;\r\n        this.node.position = rebornPos;\r\n        this.getComponent(cc.RigidBody).linearVelocity = cc.v2();\r\n    }\r\n\r\n    playerMove(moveDir: number)\r\n    {\r\n        this.moveDir = moveDir;\r\n    }\r\n\r\n    playerRecover()\r\n    {\r\n        this.gameMgr.getComponent(\"GameMgr\").updateLife(1);\r\n    }\r\n\r\n    playerDamage()\r\n    {\r\n        this.damageTime = 1;\r\n        cc.audioEngine.playEffect(this.nailSound, false);\r\n        this.gameMgr.getComponent(\"GameMgr\").updateLife(-5);\r\n    }\r\n\r\n    playerDie()\r\n    {\r\n        cc.audioEngine.playEffect(this.dieSound,false);\r\n        this.gameMgr.getComponent(\"GameMgr\").updateLife(-12);\r\n    }\r\n\r\n    playerAnimation()\r\n    {\r\n        if(this.fallDown)\r\n        {\r\n            if(this.damageTime > 0)\r\n            {\r\n                if(this.moveDir == 0 && !this.anim.getAnimationState(\"fall_front_hurt\").isPlaying)\r\n                    this.anim.play(\"fall_front_hurt\");\r\n                else if(this.moveDir != 0 && !this.anim.getAnimationState(\"fall_side_hurt\").isPlaying)\r\n                    this.anim.play(\"fall_side_hurt\");\r\n            }\r\n            else\r\n            {\r\n                if(this.moveDir == 0 && !this.anim.getAnimationState(\"fall_front\").isPlaying)\r\n                    this.anim.play(\"fall_front\");\r\n                else if(this.moveDir != 0 && !this.anim.getAnimationState(\"fall_side\").isPlaying)\r\n                    this.anim.play(\"fall_side\");\r\n            }\r\n        }\r\n        else\r\n        {\r\n            if(this.damageTime > 0)\r\n            {\r\n                if(this.moveDir == 0 && !this.anim.getAnimationState(\"idle_hurt\").isPlaying)\r\n                    this.anim.play(\"idle_hurt\");\r\n                else if(this.moveDir != 0 && !this.anim.getAnimationState(\"walk_hurt\").isPlaying)\r\n                    this.anim.play(\"walk_hurt\");\r\n            }\r\n            else\r\n            {\r\n                if(this.moveDir == 0)\r\n                {\r\n                    this.anim.stop();\r\n                    this.getComponent(cc.Sprite).spriteFrame = this.idleFrame;\r\n                }\r\n                else if(!this.anim.getAnimationState(\"walk\").isPlaying)\r\n                    this.anim.play(\"walk\");\r\n            }\r\n        }\r\n    }\r\n\r\n    onBeginContact(contact, selfCollider, otherCollider)\r\n    {\r\n        if(otherCollider.node.name == \"lowerBound\")\r\n        {\r\n            this.playerDie();\r\n        }\r\n        else if(otherCollider.node.name == \"ceiling\")\r\n        {\r\n            cc.log(\"player contact\");\r\n            this.playerDamage();\r\n        }\r\n\r\n    }\r\n}\r\n"]}